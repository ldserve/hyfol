<div class="sellpoint">

    <div class="collocation">

        {% assign str = 'sp211119ulk5,sp211123o0ye,sp211120gq63' %}
        {% assign handles = str | split:',' %}


        
        <ul class="collocation-list">

            {% for handle in handles %}
            {%- assign product = all_products[handle] -%}
            {%- assign selected_variant = product.selected_or_first_available_variant -%}

            <li class="collocation-list-item" style="left:{{- forloop.index0 |times:100 -}}%;">

                <div class="product-block-wrapper">
               
                    {% for tag in product.tags %}
                    {%- if forloop.index == 1 -%}
                    {%- assign tags = tag | handleize -%}
                    {%- else -%}
                    {%- assign tagtitlie = tag | handleize -%}
                    {%- assign tags = tags | append: "," | append: tagtitlie -%}
                    {%- endif -%}
                    {% endfor %}

                    {%- render 'product-meta', product: product, block: block -%}

                    <div class="exhibition">

                        <div class="exhibition-left">
                            {%- if product.media.size > 0 -%}
                            {%- assign primary_media = product.featured_media -%}
                            <a href="{{ product.url }}"
                                class="product-item__image-wrapper product-item_mktClick shence_commodityView {% if show_secondary_media %}product-item__image-wrapper--with-secondary{% endif %}"
                                data-scenable="1" data-expenable="1" data-bindexp="1" data-sctype="mktClick"
                                data-scdata='{"mkt_type":"product","first_mkt_name":"{{ first_mkt_name }}","first_mkt_id":"{{ section.id }}","second_mkt_rank":"{{ forloop.index }}","third_mkt_rank":"","mkt_material_url":"","mkt_material_name":"{{ mkt_material_name }}","commodity_spuid":"{{ product.handle }}","commodity_skuid":"{{ product.selected_or_first_available_variant.sku }}","commodity_name":"{{ product.title| handleize }}","original_price":"{{ product.selected_or_first_available_variant.compare_at_price }}","current_price":"{{ product.selected_or_first_available_variant.price }}","currency_unit":"USD","mkt_tag":[]}'>
                                {% if only_show_transparent and product.metafields.my_fields.transparentimg1 != blank or
                                only_show_transparent and product.metafields.my_fields.transparencydrawing[0].path !=
                                blank %}

                                {% if product.metafields.my_fields.transparentimg1 != blank%}
                                {%- assign image_url = product.metafields.my_fields.transparentimg1 | img_url: '1x1' |
                                replace:
                                '_1x1.', '_{width}x.' -%}
                                {% elsif product.metafields.my_fields.transparencydrawing[0].path != blank %}
                                {%- assign image_url = product.metafields.my_fields.transparencydrawing[0].path |
                                append:
                                product.metafields.my_fields.transparencydrawing[0].imageMd5 -%}
                                {% endif %}
                                {%- capture supported_sizes -%}{%- render 'image-size', sizes:
                                '200,300,400,500,600,700,800', image:
                                primary_media.preview_image -%}{%- endcapture -%}
                                <div class="aspect-ratio {% if settings.product_image_size != 'natural' %}aspect-ratio--{{ settings.product_image_size }}{% endif %}"
                                    style="padding-bottom: {{ 100.0 | divided_by: primary_media.preview_image.aspect_ratio }}%">
                                    <img class="product-item__primary-image lazyload image--fade-in"
                                        data-media-id="{{ primary_media.id }}" data-src="{{ image_url}}"
                                        data-sizes="auto" data-widths="[{{ supported_sizes }}]">
                                    {%- if show_secondary_media -%}
                                    {%- capture supported_sizes -%}{%- render 'image-size', sizes:
                                    '200,300,400,500,600,700,800',
                                    image: primary_media.preview_image -%}{%- endcapture -%}
                                    {% if product.metafields.my_fields.transparentimg2 != blank%}
                                    {%- assign image_url = product.metafields.my_fields.transparentimg2 | img_url: '1x1'
                                    | replace:
                                    '_1x1.', '_{width}x.' -%}
                                    {% elsif product.metafields.my_fields.transparencydrawing[1].path != blank %}
                                    {%- assign image_url = product.metafields.my_fields.transparencydrawing[1].path |
                                    append:
                                    product.metafields.my_fields.transparencydrawing[1].imageMd5 -%}
                                    {% endif %}
                                    <img class="product-item__secondary-image lazyload image--fade-in"
                                        data-src="{{ image_url }}" data-sizes="auto"
                                        data-widths="[{{ supported_sizes }}]">
                                    {%- endif -%}
                                    <noscript>
                                        <img src="{{ primary_media | img_url: '600x' }}"
                                            alt="{{ primary_media.alt | escape }}">
                                    </noscript>
                                </div>
                                {%- else -%}
                                {%- capture supported_sizes -%}{%- render 'image-size', sizes:
                                '200,300,400,500,600,700,800', image:
                                primary_media.preview_image -%}{%- endcapture -%}
                                {%- assign image_url = primary_media | img_url: '1x1' | replace: '_1x1.', '_{width}x.'
                                -%}
                                <div class="aspect-ratio {% if settings.product_image_size != 'natural' %}aspect-ratio--{{ settings.product_image_size }}{% endif %}"
                                    style="
                            padding-bottom: {{ 100.0 | divided_by: primary_media.preview_image.aspect_ratio }}%;
                            background-color: #fff;">
                                    <img class="product-item__primary-image lazyload image--fade-in"
                                        data-media-id="{{ primary_media.id }}" data-src="{{ image_url }}"
                                        data-sizes="auto" data-widths="[{{ supported_sizes }}]"
                                        alt="{{ primary_media.alt | escape }}">

                                    {%- if show_secondary_media -%}
                                    {%- capture supported_sizes -%}{%- render 'image-size', sizes:
                                    '200,300,400,500,600,700,800',
                                    image: product.media[1].preview_image -%}{%- endcapture -%}
                                    {%- assign image_url = product.media[1] | img_url: '1x1' | replace: '_1x1.',
                                    '_{width}x.' -%}

                                    <img class="product-item__secondary-image lazyload image--fade-in"
                                        data-src="{{ image_url }}" data-sizes="auto"
                                        data-widths="[{{ supported_sizes }}]" alt="{{ product.media[1].alt | escape }}">
                                    {%- endif -%}
                                    <noscript>
                                        <img src="{{ primary_media | img_url: '600x' }}"
                                            alt="{{ primary_media.alt | escape }}">
                                    </noscript>
                                </div>
                                {% endif %}
                            </a>
                            {%- endif -%}
                        </div>

                        <div class="exhibition-right">
                            
                            
                            <div class="d-flex justify-content-between "
                                style="border-bottom: 1px solid #bbb7b7 ;margin-bottom: 6px;">
                                <div class="price-list">
                                    {%- if selected_variant.compare_at_price > selected_variant.price -%}
                                    <span class="price price--highlight">
                                        <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>

                                        {%- if settings.currency_code_enabled -%}
                                        {{- selected_variant.price | money_with_currency -}}
                                        {%- else -%}
                                        {{- selected_variant.price | money -}}
                                        {%- endif -%}
                                    </span>

                                    <span class="price price--compare">
                                        <span class="visually-hidden">{{ 'product.general.regular_price' | t }}</span>

                                        {%- if settings.currency_code_enabled -%}
                                        {{- selected_variant.compare_at_price | money_with_currency -}}
                                        {%- else -%}
                                        {{- selected_variant.compare_at_price | money -}}
                                        {%- endif -%}
                                    </span>
                                    {%- else -%}
                                    <span class="price">
                                        <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>
                                        {%- if settings.currency_code_enabled -%}
                                        {{- selected_variant.price | money_with_currency -}}
                                        {%- else -%}
                                        {{- selected_variant.price | money -}}
                                        {%- endif -%}
                                    </span>
                                    {%- endif -%}
                                </div>
                                <!-- 评分 -->
                                <div class="product-rating">

                                    {%- assign url = url|default:product.url -%}
                                    {%- assign no_reviews = '(0)'-%}
                                    {%- if product.metafields.loox.num_reviews != blank -%}
                                    {%- assign rating_decimal = 0 -%}
                                    {%- assign decimal = product.metafields.loox.avg_rating | modulo: 1 -%}

                                    {%- if decimal >= 0.3 and decimal <= 0.7 -%} {%- assign rating_decimal=0.5 -%} {%-
                                        elsif decimal> 0.7 -%}
                                        {%- assign rating_decimal = 1 -%}
                                        {%- endif -%}

                                        <div class="product_rating d-flex align-items-center">
                                            <div class="rating__stars align-items-center" role="img"
                                                aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: product.metafields.loox.num_reviews, rating_max: 5 }}">
                                                {%- assign rating_as_float = product.metafields.loox.avg_rating | times:
                                                1.0 -%}
                                                {%- for i in (1..5) -%}
                                                {%- if rating_as_float >= i -%}
                                                {%- render 'icon' with 'rating-star', class: 'rating__star
                                                rating__star--full'-%}
                                                {%- else -%}
                                                {%- if rating_decimal == 0.5 -%}
                                                {%- render 'icon' with 'rating-star-half', class: 'rating__star
                                                rating__star--half'-%}
                                                {%- elsif rating_decimal == 1 -%}
                                                {%- render 'icon' with 'rating-star', class: 'rating__star
                                                rating__star--full'-%}
                                                {%- else -%}
                                                {%- render 'icon' with 'rating-star', class: 'rating__star
                                                rating__star--empty'-%}
                                                {%- endif -%}
                                                {%- assign rating_decimal = false -%}
                                                {%- endif -%}
                                                {%- endfor -%}
                                            </div>

                                            <a href="{{ url }}" class="rating__caption link-line">{{
                                                product.metafields.loox.num_reviews }} Reviews</a>
                                        </div>
                                        {%- else -%}
                                        <div class="product_rating d-flex align-items-center">
                                            <div class="rating__stars" role="img"
                                                aria-label="{{ 'general.accessibility.star_reviews_info' | t: rating_value: 0, rating_max: 5 }}">
                                                {%- for i in (1..5) -%}{%- render 'icon',icon:'rating-star', class:
                                                'rating__star
                                                rating__star--empty' -%}{%- endfor -%}
                                            </div>
                                            <a href="{{ url }}" class="rating__caption link-line">{{ no_reviews }}</a>
                                        </div>
                                        {%- endif -%}
                                </div>
                            </div>


                            <div class="product-form__variants">

                                {%- for option in product.options_with_values -%}
                                
                                
                                {%- if option.name== "COLOR" -%}
                                <!-- color -->
                                <div class="product-wrapper_option" data-selector-type="color">
                                {%- capture option_name -%}color-{{ section.id }}-{{ product.id }}-{{ forloop.index }}{%- endcapture -%}

                                {%- assign color_swatch_config = settings.color_swatch_config | newline_to_br | split: '<br />' -%}
                                    <span class="product-form__option-name text--strong">{{ option.name }}: <span class="product-form__selected-value">{{ option.selected_value }}</span></span>
                                    <div class="color-swatch-list color-swatch-list--large ld-variant-list" >
                                        {%- for value in option.values -%}
                                          {%- assign downcased_value = value | downcase -%}
                                          {%- capture color_id -%}{{ option_name }}-{{ forloop.index }}{%- endcapture -%}
                                          <div class="color-swatch {% if downcased_value == 'white' or downcased_value == 'blanc' %}color-swatch--white{% endif %} ld-variant"
                                          data-scenable="1" data-sctype="valueChange" data-scdata='{"is_quick_view":1,
                                                            "commodity_spuid": "{{product.handle}}",
                                                            "currency_unit":"USD",
                                              "commodity_name": "{{product.title | handleize }}",
                                                            "commodity_skuid":"{{ selected_variant.sku }}",
                                                            "commodity_image_quantity":"{{product.images.size}}",
                                              "commodity_description_text":["{{product.description | handleize }}"],
                                                      "commodity_description_image":["{{ product.featured_image | image_url | split: "?" | first  }}"],
                                                            "commodity_size":"",
                                                      "commodity_color":"",
                                                            "commodity_tag":"{{tags}}",
                                              "commodity_type":"{{product.type | handleize}}",
                                                            "original_price":"{{ product.selected_or_first_available_variant.compare_at_price }}",
                                                      "current_price":"{{ product.selected_or_first_available_variant.price }}"}'>
                                            <input class="color-swatch__radio " type="radio" name="{{ option_name }}" id="{{ color_id }}" value="{{ value | escape }}"   {% if option.selected_value == value %}checked{% endif %} data-option-position="{{ option.position }}">
                                            <label class="color-swatch__item" for="{{ color_id }}" style="{% render 'color-swatch-style', color_swatch_config: color_swatch_config, value: downcased_value %}" title="{{ value | escape }}">
                                              <span class="visually-hidden">{{ value }}</span>
                                              {%- render 'icon', icon: 'cross-sold-out' -%}
                                            </label>
                                          </div>
                                        {%- endfor -%}
                                </div>
                            </div>
                                {%- endif -%}

                                {%- if option.name == "SIZE" -%}
                                <!-- size -->
                                <div class="product-wrapper_option" data-selector-type="block">
                                {%- capture size_name -%}block-{{ section.id }}-{{ product.id }}-{{ forloop.index }}{%- endcapture -%}
                                <div>
                                    <span class="product-form__option-name text--strong">{{ option.name }}: <span class="product-form__selected-value">{{ option.selected_value }}</span></span>
                                    <div class="block-swatch-list">
                                      {%- for value in option.values -%}
                                        {%- capture block_swatch_id -%}{{ size_name }}-{{ forloop.index }}{%- endcapture -%}
                                        <div class="block-swatch">
                                          <input class="block-swatch__radio " type="radio" name="{{ size_name }}" id="{{ block_swatch_id }}" value="{{ value | escape }}"  {% if option.selected_value == value %}checked{% endif %} data-option-position="{{ option.position }}"  >
                                          <label class="block-swatch__item" for="{{ block_swatch_id }}" title="{{ value | escape }}" >
                                            <span class="block-swatch__item-text">{{ value }}</span>
                                          </label>
                                        </div>
                                      {%- endfor -%}
                                    </div>
                                </div>
                                </div>
                                {%- endif -%}

                                {%- endfor -%}
                            </div>
                            <!-- add to cart -->
                            {%- form 'product', product, id: form_id, class: product_form_classes -%}
                            {% for tag in product.tags %}
                            {%- if forloop.index == 1 -%}
                            {%- assign tags = tag | handleize -%}
                            {%- else -%}
                            {%- assign tagtitlie = tag | handleize -%}
                            {%- assign tags = tags | append: "," | append: tagtitlie -%}
                            {%- endif -%}
                            {% endfor %}

                            {%- for line_item in cart.items -%}
                            {%- if forloop.index == 1 -%}
                            {%- assign id = line_item.sku -%}
                            {%- else -%}
                            {%- assign id = id | append: "," | append: line_item.sku -%}
                            {%- endif -%}
                            {%- endfor -%}

                            {%- if product.template_suffix != 'contact' -%}
                            {%- if product.selected_or_first_available_variant.available -%}
                            {%- if product.template_suffix == 'pre-order' -%}
                            <button type="submit" class="product-form__add-button button button--primary"
                                data-action="add-to-cart" onclick="return gtag_report_conversion();">{{
                                'product.form.pre_order'
                                | t }}</button>
                            {%- else -%}
                            <button type="submit" class="product-form__add-button button button--primary"
                                data-scenable="1" data-sctype="addCart" data-scdata='{"is_quick_view":{% if template == "product.quick-view" %}1{% else %}0{% endif %},
                                            "commodity_spuid": "{{product.handle}}",
                               "commodity_name": "{{product.title | handleize }}",
                                            "currency_unit":"USD",
                                            "commodity_skuid":"{{ product.selected_or_first_available_variant.sku }}",
                              "commodity_size":"",
                                      "commodity_color":"",
                                            "commodity_image_quantity":"{{product.images.size}}",
                              "commodity_description_text":["{{product.description | handleize }}"],
                                      "commodity_description_image":["{{ product.featured_image | image_url | split: "?" | first  }}"],
                                            "commodity_tag":"{{ tags }}",
                              "commodity_type":"{{product.type | handleize}}",
                                            "original_price":"{{ product.selected_or_first_available_variant.compare_at_price }}",
                                      "current_price":"{{ product.selected_or_first_available_variant.price }}",
                              "discount_price":"",
                              "compliment_commodities":"{{ id }}",
                              "bonus_name":"",
                              "bonus_amount":0,
                              "entrance":"CommodityDetailPage_AddToCart"}' data-action="add-to-cart"
                                onclick="return gtag_report_conversion();">{{ 'product.form.add_to_cart' | t }}</button>
                            {%- endif -%}
                            {%- else -%}
                            <button type="submit" class="product-form__add-button button button--disabled" disabled>{{
                                'product.form.sold_out' | t }}</button>
                            {%- endif -%}
                            {%- else -%}
                            <a href="mailto:{{ shop.email }}" class="button button--primary">{{
                                'product.form.contact_us' | t
                                }}</a>
                            {%- endif -%}
                            {%- endform -%}
                        </div>
                    </div>

                </div>

            </li>

            {%- endfor -%}
        </ul>
        <div class="switch-product">
            <span class="prevButton">{%- render :'icon', icon:'arrow-left' -%}</span>
            <span class="nextButton">{%- render :'icon', icon:'arrow-right' -%}</span>
        </div>
        {%- comment -%}点{%- endcomment -%}
        <div class="scroll-dot">
            {% for Num in handles %}
            <li></li>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    ~function () {
        let scorllNum = {{ handles.size }}  //商品件数
    let collocationList = document.querySelector('.collocation-list')    //ul
    let collocationListItem = document.querySelector('.collocation-list-item')  //li
    let activeIndex = 0;//当前活跃index
    let firstLi = collocationList.firstElementChild //首尾节点
    let lastLi = collocationList.lastElementChild
    let scrollDot = document.querySelector(".scroll-dot")//小点
    //给所有小点添加index
    var lis = scrollDot.getElementsByTagName("li")
    for (i = 0; i < lis.length; i++) {
        lis[i].index = i
        lis[i].addEventListener("click", changeItem)
    }
    lis[activeIndex].className = "scroll-dot__active-li"

    var animationsflag = true //是否阻止动画
    document.querySelector('.prevButton').addEventListener("click", prevItem)
    document.querySelector('.nextButton').addEventListener("click", nextItem)

    //监听动画开始和结束
    collocationList.addEventListener("animationstart", animationStart)
    collocationList.addEventListener("transitionstart", animationStart)
    collocationList.addEventListener("animationend", animationEnd)
    collocationList.addEventListener("transitionend", animationEnd)

    function animationStart() {
        animationsflag = false
    }
    function animationEnd() {
        animationsflag = true
    }
    //添加上一个item的动画
    const prevkeyframes = `
    @keyframes prevItem1{
            0% { transform:  translate(-${scorllNum * 100}% ,0);  }
            100% { transform:  translate(-${(scorllNum - 1) * 100}%,0);}
        }
        @keyframes prevItem2{
            0% { transform:  translate(-${scorllNum * 100}% ,0);  }
            100% { transform:  translate(-${(scorllNum - 1) * 100}%,0);}
        }
    `
    const style = document.createElement("style");
    style.type = "text/css";
    style.innerHTML = prevkeyframes;
    document.getElementsByTagName('head')[0].appendChild(style)

    function changeItem() {
        if (animationsflag) {
            activeIndex = this.index
            for (i = 0; i < lis.length; i++) {
                lis[i].className = ""
            }
            lis[activeIndex].className = "scroll-dot__active-li"
            firstLi.style.left = "0%"
            lastLi.style.left = (scorllNum - 1) * 100 + "%"
            collocationList.style.transform = `translate( -${activeIndex * 100}% , 0px )`;
        }
    }

    function prevItem() {
        if (animationsflag) {
            if (activeIndex == 0) {
                activeIndex = scorllNum - 1
                lastLi.style.left = (scorllNum - 1) * 100 + "%"
                firstLi.style.left = scorllNum * 100 + "%"

                if (collocationList.className == "collocation-list prevItem1") {
                    collocationList.className = "collocation-list prevItem2"
                } else {
                    collocationList.className = "collocation-list prevItem1"
                }

            } else {
                activeIndex -= 1
                firstLi.style.left = "0%"
                lastLi.style.left = (scorllNum - 1) * 100 + "%"
            }
            collocationList.style.transform = `translate( -${activeIndex * 100}% , 0px )`;
        }
    }
    function nextItem() {
        if (animationsflag) {
            if (activeIndex == scorllNum - 1) {
                activeIndex = 0
                firstLi.style.left = "0%"
                lastLi.style.left = "-100%"

                if (collocationList.className == "collocation-list nextItem1") {
                    collocationList.className = "collocation-list nextItem2"
                } else {
                    collocationList.className = "collocation-list nextItem1"
                }

            } else {
                activeIndex += 1
                firstLi.style.left = "0%"
                lastLi.style.left = (scorllNum - 1) * 100 + "%"
            }
            collocationList.style.transform = `translate( -${activeIndex * 100}% , 0px )`;
        }
    }
  }();


// 搭配购
(function(){
    const options =document.querySelector('.product-block-wrapper').querySelectorAll('.product-wrapper_option')
    options.forEach(option=>{
        option.addEventListener('click',(ev)=>{
            if(ev.target.tagName==="INPUT"){
                const target=ev.target
                const selectedValueElement  =  option.querySelector('.product-form__selected-value')
                selectedValueElement.innerHTML=target.value
            }
        })
    })
})();
</script>
<style>
    .switch-product {
        display: flex;
        justify-content: space-between;
    }

    .switch-product span {
        cursor: pointer;
        font-size: 20px;
    }

    .exhibition {
        display: flex;
    }

    .exhibition-right {
        padding-left: 10px;

    }

    .exhibition-left {
        width: 300px;
        height: 300px;
    }

    .product-form__payment-container {
        border: none;
    }

    .margin-b-20 {
        margin-bottom: 20px;
    }
</style>